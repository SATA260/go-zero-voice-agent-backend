syntax = "proto3";

package pb;
option go_package = "./pb";

message UploadFileReq {
    string userId = 1;
    string fileName = 2;
    string filePath = 3;
    string content_type = 4;
    int64  fileSize = 5;
    bytes  chunk = 6;
}

message UploadFileResp {
    string file_path = 1;
}

message QueryReq {
    string userId = 1;
    string query = 2;
    string fileId = 3;
    int32 topK = 4;
    string entityId = 5;
}

message QueryMultipleReq {
    string userId = 1;
    string query = 2;
    repeated string fileIds = 3;
    int32 topK = 4;
}

message RetrievalResult {
    string pageContent = 1;
    map<string, string> metadata = 2;
    double score = 3;
}

message QueryResp {
    repeated RetrievalResult results = 1;
}

message FetchDocumentsReq {
    string userId = 1;
    repeated string ids = 2;
}

message DocumentRecord {
    string pageContent = 1;
    map<string, string> metadata = 2;
}

message FetchDocumentsResp {
    repeated DocumentRecord documents = 1;
}

message DeleteDocumentsReq {
    string userId = 1;
    repeated string ids = 2;
}

message DeleteDocumentsResp {
    int32 deletedCount = 1;
}

service DocService {
    rpc UploadFile(stream UploadFileReq) returns (UploadFileResp);
    rpc FetchDocuments(FetchDocumentsReq) returns (FetchDocumentsResp);
    rpc DeleteDocuments(DeleteDocumentsReq) returns (DeleteDocumentsResp);
}

service RagService {
    rpc Query(QueryReq) returns (QueryResp);
    rpc QueryMultiple(QueryMultipleReq) returns (QueryResp);
}
